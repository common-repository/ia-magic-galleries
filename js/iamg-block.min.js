/*! ia-designer 09-10-2024 
Copyright Â© 2024 Information Aesthetics. All rights reserved.
This work is licensed under the GPL2, V2/ license.*/

!function(){const t=wp.element.createElement,e=iap_loader_settings,i=wp.i18n.__;let n,o=0,r={},a=e.wp_version&&parseFloat(e.wp_version)<5.8?"widgets":"media";wp.blocks.registerBlockType("ia-mg/gallery",{title:i("IA Magic Gallery"),icon:"format-gallery",category:a,supports:{align:!0},example:{},attributes:{presentation:{type:"string"},pres_id:{type:"string"},block_id:{type:"string"},behavior:{type:"string",default:"fixed"},height:{type:"string",default:"100"},height_percent:{type:"boolean",default:!0},width:{type:"string",default:"0"},width_percent:{type:"boolean",default:!0},properties:{type:"string",default:""},background_color:{type:"string",default:"#fff"},background_opacity:{type:"string",default:"0"}},usesContext:["postId"],edit:function(a){n=a.context?a.context.postId:null,s=a.clientId,a.attributes.block_id||a.setAttributes({block_id:s}),!a.attributes.pres_id&&a.attributes.block_id&&function(t){a.setAttributes({pres_id:t})}(a.attributes.block_id);var s;a.attributes.block_id&&a!==r[a.attributes.block_id]&&(r[a.attributes.block_id]=a);const d=Object.assign({},e.settings),h={load_condition:function(){let t=document.querySelectorAll(".interface-interface-skeleton__content .IA_Presenter_Container");if(t.length)return!0;let e=document.querySelector('iframe[name="editor-canvas"]');if(e){let t=e.contentDocument||e.contentWindow.document,i=t.querySelectorAll(".IA_Presenter_Container");return i.length}return!1},after_callback:function(t){if(l||!window.eve_ia)return;l=!0,eve_ia.on(["global","iamg","gallery","save"],function(t){const e=this,o=e.getBlockId(),a=r[o];let l=a.attributes.pres_id;const s={command:"save",block_id:o,pres_id:l,post_id:n,locator:t};e.comManager.wpCommand(s,function(t){let n={margin:{top:10,bottom:5,left:10,right:5}};if(t.error)return e.eve("gui.alert",i("Gallery was not saved successfully")+".",[220,70],[i("OK")],[],n),e.eve("gui.error",t.error),submit_button&&(submit_button.disabled=!1),void(save_button&&(save_button.disabled=!1));let o=t.settings?JSON.stringify(t.settings):"";a.setAttributes({properties:o}),e.eve("gui.alert",i("Gallery is saved successfully")+".",[200,70],[i("OK")],void 0,n),wp.data.dispatch("core/editor").savePost()},function(t){})}),eve_ia.on(["global","iamg","gallery","removed"],function(t){const e=this.getBlockId(),i=r[e];let a=i.attributes.pres_id;o=Math.max(o-1,0);const l={command:"remove",block_id:e,pres_id:a,post_id:n,locator:t};this.comManager.wpCommand(l,function(t){},function(t){})}),eve_ia.on(["ia","gui","created"],function(t){const e=this;if(Snap_ia.window().MutationObserver){let t=new MutationObserver(function(t){e.eve("gui.panel.resize")});const i=e.div_container.node.parentNode;i&&t.observe(i,{attributes:!0,attributeOldValue:!1,attributeFilter:["data-align","class"]})}if(Snap_ia.window().ResizeObserver){let t=new ResizeObserver(function(t){e.eve("gui.panel.resize")});const i=document.getElementsByClassName("interface-interface-skeleton__content")[0];i&&t.observe(i)}o++,e.eve.once(["presenter","loaded"],function(t){const e=t.getBlockId();let i=r[e].attributes,n=i.properties;n&&(n=JSON.parse(n));i.background_color&&t.setPanelStyle({fill:i.background_color,fillOpacity:i.background_opacity/100});if(!n.type)return;const o=n.type;let a=n.images||[];const l=n.requested_images||[],s=n.resource;let c,u;for(let t in n)n.hasOwnProperty(t)&&t.startsWith(o)&&((c=c||{})[t]=n[t]);u=function(t,e){const i=[];let n=e.length;for(let o,r=0;r<t.length;r++){o=t[r].title;for(let a=0;a<n;a++){let l=e[(r+a)%n];if(o===l.title){i.push({id:o+"_"+l.id,url:t[r].thumbnail.url,title:o});break}}}return i}(a,l),t.eve(["iamg","load_gallery_setup"],void 0,o,u,c,s)}.bind(void 0,e))(100)})}.bind(void 0,a.attributes),post_scripts:["media_upload.min.js"]};setTimeout(()=>{window.IA_Presenter_loader&&IA_Presenter_loader(d,void 0,e.resources,h)},5);let p=+a.attributes.height;p&&a.attributes.height_percent&&(p+="vh");if(!p||"100vh"===p){let t=0;const e=jQuery(".interface-interface-skeleton__header");e.length&&(t=e.height());const i=jQuery(".interface-interface-skeleton__footer");i.length&&(t+=i.height()),p="calc(100vh - "+t+"px)"}let b=+a.attributes.width,g=a.attributes.width_percent?"vw":"px",_={height:p};b&&(_.width=b+g,_["margin-left"]="calc(50% - "+b/2+g+")");return t("div",{className:"IA_Presenter_Container","data-block-id":a.attributes.block_id,presentation:a.attributes.pres_id?a.attributes.pres_id:"",behavior:"fixed",style:_},function(e){if(!c())return;const n="fixed"!==e.attributes.behavior,o=t("svg",{width:20,height:20},t("path",{d:"M6.368.937a1.016,1.016,0,0,1,.513.092.871.871,0,0,1,.256.919.482.482,0,0,1-.6.367c-.855,0-1.795.092-2.65.092l4.1,4.411a.692.692,0,0,1-.171,1.01.624.624,0,0,1-.855-.092L2.949,3.418c0,.919,0,1.838-.085,2.848a.866.866,0,0,1-.256.643c-.257.276-.684.184-.941-.183a1.253,1.253,0,0,1-.085-.552c0-1.47.085-2.94.085-4.41a.765.765,0,0,1,.684-.735C3.719,1.029,5.086,1.029,6.368.937Zm11.281.092a.7.7,0,0,1,.684.735c.085,1.47.085,2.94.085,4.41a1.253,1.253,0,0,1-.085.552.654.654,0,0,1-.941.183.739.739,0,0,1-.256-.643c0-.919,0-1.837-.085-2.848L13.034,7.736a.615.615,0,0,1-.855.092.692.692,0,0,1-.171-1.01l4.1-4.411c-.855,0-1.795-.092-2.65-.092a.566.566,0,0,1-.6-.367.682.682,0,0,1,.256-.919,1.016,1.016,0,0,1,.513-.092C15,1.029,16.281,1.029,17.649,1.029ZM2.351,18.854a.7.7,0,0,1-.684-.736c-.085-1.47-.085-2.94-.085-4.41a1.251,1.251,0,0,1,.085-.551.655.655,0,0,1,.941-.184.741.741,0,0,1,.256.643c0,.919,0,1.838.085,2.849l4.017-4.319a.616.616,0,0,1,.855-.091.692.692,0,0,1,.171,1.01l-4.1,4.41c.855,0,1.8.092,2.65.092a.567.567,0,0,1,.6.368.682.682,0,0,1-.256.919,1.026,1.026,0,0,1-.513.091C5.086,18.945,3.719,18.854,2.351,18.854Zm11.281.091a1.026,1.026,0,0,1-.513-.091.871.871,0,0,1-.256-.919.483.483,0,0,1,.6-.368c.855,0,1.8-.092,2.65-.092l-4.1-4.41a.692.692,0,0,1,.171-1.01.625.625,0,0,1,.855.091l4.017,4.319c0-.919,0-1.838.085-2.849a.869.869,0,0,1,.256-.643c.257-.275.684-.183.941.184a1.251,1.251,0,0,1,.085.551c0,1.47-.085,2.94-.085,4.41a.765.765,0,0,1-.684.736C16.281,18.854,15,18.945,13.632,18.945ZM20,20H0V0H20ZM.471,19.529H19.529V.471H.471Z"}),n?t("path",{fill:"#BC1F47",d:"M0.5,20.3c-0.2,0-0.4-0.1-0.5-0.2c-0.3-0.3-0.3-0.8,0-1.1L19-0.1c0.3-0.3,0.8-0.3,1.1,0s0.3,0.8,0,1.1L1,20.1C0.9,20.2,0.7,20.3,0.5,20.3z"}):null);let r=t(wp.blockEditor.BlockIcon,{icon:o});return t(wp.blockEditor.BlockControls,{key:"element_fullscreen"},t(wp.components.ToolbarButton,{icon:r,label:i(n?"Set to Fixed Placement on Page":"Set to Full Page Gallery (Alignment is disregarded)"),onClick:()=>{u(!n,e,!0)}}))}(a),function(e){if("fixed"!==e.attributes.behavior)return;const n=t("svg",{width:20,height:20},t("path",{d:"M0,0v20h20V0H0z M19.5,19.5H0.5V0.5h19.1V19.5z M10.1,19.1C10,19.1,10,19.1,10.1,19.1c-0.2,0-0.4,0-0.5-0.1l-2.9-2.9c-0.2-0.2-0.2-0.5,0-0.7s0.5-0.2,0.7,0l2.1,2.1v-6.4c0-0.3,0.2-0.5,0.5-0.5s0.5,0.2,0.5,0.5v6.4l2.1-2.1c0.2-0.2,0.5-0.2,0.7,0s0.2,0.5,0,0.7l-2.9,2.9C10.3,19,10.2,19.1,10.1,19.1z M10,9.6c-0.3,0-0.5-0.2-0.5-0.5V2.7L7.4,4.8C7.2,5,6.9,5,6.7,4.8s-0.2-0.5,0-0.7l2.9-2.9C9.7,1.1,9.8,1.1,10,1.1c0.1,0,0.3,0,0.4,0.1l2.9,2.9c0.2,0.2,0.2,0.5,0,0.7s-0.5,0.2-0.7,0l-2.1-2.1v6.4C10.5,9.4,10.3,9.6,10,9.6z"}));let o=t(wp.blockEditor.BlockIcon,{icon:n});return t(wp.blockEditor.BlockControls,{key:"height_menu"},t(wp.components.ToolbarDropdownMenu,{icon:o,label:i("Height (Check Settings for more options)"),controls:[{title:"100%",onClick:()=>{e.setAttributes({height:100,height_percent:!0})}},{title:"75%",onClick:()=>{e.setAttributes({height:75,height_percent:!0})}},{title:"50%",onClick:()=>{e.setAttributes({height:50,height_percent:!0})}},{title:"25%",onClick:()=>{e.setAttributes({height:25,height_percent:!0})}}]}))}(a),function(e){let n=e.attributes.block_id;e.attributes.behavior;let o,r="IAMG_Height_Panel_"+n;window.IA_Designer&&(o=IA_Designer.getGui(t=>t.getBlockId()===n));const a="fixed"!==e.attributes.behavior;let l=e.attributes.height_percent?t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({height_percent:!1});let t=+e.attributes.height;const i=t*(window.innerHeight-0)/100;e.setAttributes({height:String(i)})}},"%"):t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({height_percent:!0});let t=+e.attributes.height;const i=100*t/(window.innerHeight-0);e.setAttributes({height:String(i)})},marginTop:"auto"},"Px"),s=a?void 0:t(wp.components.PanelBody,{title:i("Height"),initialOpen:!0,className:r},t(wp.components.PanelRow,{},t("div",{class:"IAMG_Layout_FlexRow"},t(wp.components.TextControl,{type:"number",onChange:t=>{e.setAttributes({height:String(t)})},value:e.attributes.height||"",class:"IAMG_Layout_ButtHeight"}),l)));let d=e.attributes.width_percent?t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({width_percent:!1});const t=+e.attributes.width*window.innerWidth/100;e.setAttributes({width:String(t)})}},"%"):t(wp.components.Button,{isDefault:!0,onClick:()=>{e.setAttributes({width_percent:!0});const t=100*+e.attributes.width/window.innerWidth;e.setAttributes({width:String(t)})},marginTop:"auto"},"Px"),h=t(wp.components.PanelBody,{title:i("Width"),initialOpen:!1,className:"IAMG_Width_Panel_"+n},t(wp.components.PanelRow,{},t("text",{},"It is better to set width with block alignment for a standalone block! ")),t(wp.components.PanelRow,{},t("text",{},"Width must be set in the context of Row or Columns!")),t(wp.components.PanelRow,{},t("div",{class:"IAMG_Layout_FlexRow"},t(wp.components.TextControl,{type:"number",onChange:t=>{e.setAttributes({width:t})},value:e.attributes.width||"",class:"IAMG_Layout_ButtHeight"}),d))),p=t(wp.components.PanelBody,{title:i("Layout"),initialOpen:!0,className:"IAMG_Layout_Panel_"+n},t(wp.components.PanelRow,{},t(wp.components.ToggleControl,{label:i("Fixed (or Full)"),onChange:t=>{u(t,e,!0)},checked:"fixed"!==e.attributes.behavior})),t(wp.components.PanelRow,{},t("text",{},i(a?"The gallery will take the full page. Only one full gallery can be placed on a page as all other elements will be removed.":"The gallery will have fixed location in the page. Set the height behavior below!")))),b=e.attributes.background_color,g=t(wp.components.PanelBody,{title:i("Background Color"),initialOpen:!0},t(wp.components.PanelRow,{},t(wp.blockEditor.PanelColorSettings,{colorSettings:[{value:b,onChange:t=>{e.setAttributes({background_color:t}),o&&o.setPanelStyle({fill:t})},label:i("Color")}],className:"IAMG_Layout_FullWidth"})),t(wp.components.PanelRow,{},t(wp.components.RangeControl,{label:i("Opacity"),onChange:t=>{e.setAttributes({background_opacity:t}),o&&o.setPanelStyle({fillOpacity:t/100})},value:e.attributes.background_opacity||0,min:0,max:100,className:"IAMG_Layout_FullWidth"})));return t(wp.blockEditor.InspectorControls,{},c()?p:null,s,h,g)}(a))},save:function(e){if(e.attributes.pres_id){let i={behavior:e.attributes.behavior,height:e.attributes.height,height_type:e.attributes.height_percent?"percent":"pixel",background_color:e.attributes.background_color,background_opacity:e.attributes.background_opacity},n=function(t){let e=" ";return Object.keys(t).forEach(i=>{const n=t[i];"object"==typeof n?Object.keys(n).forEach(t=>{e+=" "+i+"_"+t+'="'+n[t]+'"'}):e+=" "+i+'="'+n+'"'}),e}(i),o='[ia_magic_gallery id="'+e.attributes.pres_id+'"'+n+"]",r=t("div",{},o);return r}{let e=t("div",{},'[ia_magic_gallery id="demo"]');return e}}});let l=!1;let s={};function c(){return 1===o}function u(t,e,i){t&&c()&&(s.height=e.attributes.height,s.height_percent=e.attributes.height_percent,s.width=e.attributes.width,s.width_percent=e.attributes.width_percent,e.setAttributes({behavior:"full",height:100,height_percent:!0})),t||(i&&"full"===e.attributes.behavior&&s.hasOwnProperty("height")?e.setAttributes({height:s.height,height_percent:s.height_percent,width:s.width,width_percent:s.width_percent,behavior:"fixed"}):e.setAttributes({behavior:"fixed"}))}}();